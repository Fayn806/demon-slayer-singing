# 物品系统需求文档 (ITM)

## 文档信息
- 文档编号：REQ-ITM-v1.0
- 创建日期：2025-07-22
- 作者：系统分析师
- 状态：草案

## 1. 概述

### 1.1 目的
本文档定义了TrueSinging游戏中物品系统的功能需求，包括物品的创建、管理、收集和交互等功能。

### 1.2 范围
物品系统涵盖游戏中所有可收集物品的管理，包括基础物品配置、物品生成、收集机制和物品属性管理。

### 1.3 相关文档
- 代码结构整合文档.md
- src/ReplicatedStorage/Library/Configs/Items.lua
- src/StarterPlayer/StarterPlayerScripts/Client/Controllers/

## 2. 功能需求

### 2.1 泛在型需求 (Ubiquitous Requirements)

#### REQ-ITM-001
- **需求编号**：REQ-ITM-001
- **需求类型**：泛在型
- **优先级**：高
- **需求描述**：系统应提供13种基础物品（Item1到Item13），每种物品具有唯一的标识符、名称、图标和3D模型。
- **来源文件**：Configs/Items.lua
- **验收标准**：
  - 系统中存在13种不同的物品定义
  - 每种物品具有唯一的ID
  - 每种物品具有对应的名称、图标路径和模型引用

#### REQ-ITM-002
- **需求编号**：REQ-ITM-002
- **需求类型**：泛在型
- **优先级**：高
- **需求描述**：系统应为每个物品分配基础金币产出值和大小属性。
- **来源文件**：Configs/Items.lua
- **验收标准**：
  - 每个物品具有明确的金币产出值
  - 每个物品具有大小属性（用于显示和物理计算）
  - 金币产出值必须为正数

#### REQ-ITM-003
- **需求编号**：REQ-ITM-003
- **需求类型**：泛在型
- **优先级**：中
- **需求描述**：系统应支持物品的3D模型加载和显示。
- **来源文件**：Configs/Items.lua
- **验收标准**：
  - 物品的3D模型能够正确加载
  - 模型在游戏世界中正确显示
  - 模型大小与配置的大小属性一致

### 2.2 事件驱动型需求 (Event-driven Requirements)

#### REQ-ITM-004
- **需求编号**：REQ-ITM-004
- **需求类型**：事件驱动型
- **优先级**：高
- **需求描述**：当玩家点击或接触物品时，系统应触发收集事件。
- **来源文件**：Client/Controllers/
- **验收标准**：
  - 玩家点击物品时触发收集动作
  - 收集事件包含物品ID和玩家信息
  - 收集成功后物品从场景中移除

#### REQ-ITM-005
- **需求编号**：REQ-ITM-005
- **需求类型**：事件驱动型
- **优先级**：高
- **需求描述**：当物品被收集时，系统应根据物品的基础金币产出值增加玩家的金币。
- **来源文件**：Configs/Items.lua, Client/Controllers/
- **验收标准**：
  - 收集物品后玩家金币增加
  - 增加的金币数量等于物品的基础产出值
  - 金币更新立即反映在UI上

#### REQ-ITM-006
- **需求编号**：REQ-ITM-006
- **需求类型**：事件驱动型
- **优先级**：中
- **需求描述**：当启用自动收集功能时，系统应自动收集玩家范围内的所有物品。
- **来源文件**：Client/Interface/Main.lua
- **验收标准**：
  - 自动收集功能可以开启/关闭
  - 开启后自动收集指定范围内的物品
  - 收集过程遵循正常的收集规则

### 2.3 状态驱动型需求 (State-driven Requirements)

#### REQ-ITM-007
- **需求编号**：REQ-ITM-007
- **需求类型**：状态驱动型
- **优先级**：中
- **需求描述**：当物品处于"已生成"状态时，系统应在游戏世界中显示该物品的3D模型。
- **来源文件**：Configs/Items.lua
- **验收标准**：
  - 物品生成后立即可见
  - 物品位置固定不变
  - 物品可以被玩家交互

#### REQ-ITM-008
- **需求编号**：REQ-ITM-008
- **需求类型**：状态驱动型
- **优先级**：中
- **需求描述**：当物品处于"冻结"状态时（冰冻风暴事件期间），系统应禁止玩家收集该物品。
- **来源文件**：Configs/Global Events.lua
- **验收标准**：
  - 冻结状态的物品显示特殊效果
  - 玩家无法收集冻结的物品
  - 冻结状态结束后恢复正常

### 2.4 可选特性需求 (Optional Feature Requirements)

#### REQ-ITM-009
- **需求编号**：REQ-ITM-009
- **需求类型**：可选特性
- **优先级**：低
- **需求描述**：如果启用了物品特效，系统应在物品周围显示粒子效果。
- **来源文件**：Client/Controllers/
- **验收标准**：
  - 特效可以开启/关闭
  - 特效不影响物品收集功能
  - 特效符合物品类型特征

#### REQ-ITM-010
- **需求编号**：REQ-ITM-010
- **需求类型**：可选特性
- **优先级**：低
- **需求描述**：如果玩家拥有收集加成，系统应在收集物品时应用相应的倍率。
- **来源文件**：Configs/Items.lua
- **验收标准**：
  - 加成倍率正确应用
  - 最终金币 = 基础产出 × 加成倍率
  - UI显示加成效果

### 2.5 复杂型需求 (Complex Requirements)

#### REQ-ITM-011
- **需求编号**：REQ-ITM-011
- **需求类型**：复杂型
- **优先级**：高
- **需求描述**：当金币冲刺事件激活时，系统应将所有物品的金币产出提升3倍，同时当玩家拥有变异加成时，系统应同时应用变异倍率。
- **来源文件**：Configs/Global Events.lua, Configs/Mutations.lua
- **验收标准**：
  - 事件期间物品产出 = 基础产出 × 3 × 变异倍率
  - 多重加成正确叠加
  - UI显示所有激活的加成

#### REQ-ITM-012
- **需求编号**：REQ-ITM-012
- **需求类型**：复杂型
- **优先级**：中
- **需求描述**：系统应支持物品的批量生成，当服务器决定生成物品时，系统应在指定区域内随机放置物品，同时确保物品不会重叠。
- **来源文件**：ReplicatedStorage/Replication.lua
- **验收标准**：
  - 物品在指定区域内随机分布
  - 物品之间保持最小距离
  - 生成过程不影响游戏性能

## 3. 非功能需求

### 3.1 性能需求
- 物品收集响应时间应小于100ms
- 支持同时显示至少100个物品
- 物品模型加载不应造成明显卡顿

### 3.2 可靠性需求
- 物品收集必须保证数据一致性
- 网络延迟不应导致物品重复收集
- 断线重连后物品状态应正确恢复

### 3.3 安全性需求
- 防止玩家通过修改客户端获得额外物品
- 所有物品收集必须经过服务器验证
- 防止物品ID被恶意篡改

## 4. 接口需求

### 4.1 模块接口
- 与变异系统接口：获取当前变异倍率
- 与事件系统接口：获取当前激活事件
- 与UI系统接口：更新物品显示和金币数值
- 与音效系统接口：播放收集音效

### 4.2 数据接口
```lua
-- 物品数据结构
Item = {
    id = string,
    name = string,
    baseCoins = number,
    size = number,
    icon = string,
    model = Instance
}

-- 收集事件数据
CollectEvent = {
    itemId = string,
    playerId = number,
    position = Vector3,
    timestamp = number
}
```

## 5. 验收测试方案

### 5.1 功能测试
1. 验证13种物品的正确配置
2. 测试物品收集功能
3. 测试自动收集功能
4. 测试事件期间的倍率计算

### 5.2 性能测试
1. 测试大量物品同时存在时的性能
2. 测试快速连续收集的响应时间
3. 测试物品生成的性能影响

### 5.3 兼容性测试
1. 测试不同设备上的物品显示
2. 测试网络延迟下的收集功能
3. 测试与其他系统的交互

## 6. 风险和假设

### 6.1 风险
- 物品数量过多可能影响游戏性能
- 网络同步可能导致物品状态不一致
- 自动收集可能被恶意利用

### 6.2 假设
- Roblox平台API保持稳定
- 玩家设备满足最低配置要求
- 网络连接基本稳定

## 7. 版本历史
| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| 1.0 | 2025-07-22 | 初始版本 | 系统分析师 |